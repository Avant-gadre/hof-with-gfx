increase_state_category = {
	if = {
		limit = {
			has_state_category = zero_island
		}
		set_state_category = one_island
		add_extra_state_shared_building_slots = 1
	}
	else_if = {
		limit = {
			has_state_category = one_island
		}
		set_state_category = port
		add_extra_state_shared_building_slots = 1
	}
	else_if = {
		limit = {
			has_state_category = port
		}
		set_state_category = major_port
		add_extra_state_shared_building_slots = 1
	}
	else_if = {
		limit = {
			has_state_category = major_port
		}
		set_state_category = five
		add_extra_state_shared_building_slots = 1
	}
	else_if = {
		limit = {
			OR = {
				has_state_category = wasteland
			}
		}
		set_state_category = one
		add_extra_state_shared_building_slots = 1
	}
	else_if = {
		limit = {
			has_state_category = one
		}
		set_state_category = two
		add_extra_state_shared_building_slots = 1
	}
	else_if = {
		limit = {
			has_state_category = two
		}
		set_state_category = three
		add_extra_state_shared_building_slots = 1
	}
	else_if = {
		limit = {
			has_state_category = three
		}
		set_state_category = four
		add_extra_state_shared_building_slots = 1
	}
	else_if = {
		limit = {
			has_state_category = four
		}
		set_state_category = five
		add_extra_state_shared_building_slots = 1
	}
	else_if = {
		limit = {
			has_state_category = five
		}
		set_state_category = six
		add_extra_state_shared_building_slots = 1
	}
	else_if = {
		limit = {
			has_state_category = six
		}
		set_state_category = seven
		add_extra_state_shared_building_slots = 1
	}
	else_if = {
		limit = {
			has_state_category = seven
		}
		set_state_category = eight
		add_extra_state_shared_building_slots = 1
	}
	else_if = {
		limit = {
			has_state_category = eight
		}
		set_state_category = nine
		add_extra_state_shared_building_slots = 1
	}
	else_if = {
		limit = {
			has_state_category = nine
		}
		set_state_category = ten
		add_extra_state_shared_building_slots = 1
	}
	else_if = {
		limit = {
			has_state_category = ten
		}
		set_state_category = eleven
		add_extra_state_shared_building_slots = 1
	}
	else_if = {
		limit = {
			has_state_category = eleven
		}
		set_state_category = twelve
		add_extra_state_shared_building_slots = 1
	}
}

upgrade_industrial_region = {
	if = {
		limit = {
			has_dynamic_modifier = {
				modifier = industrial_area_Lv1
			}
		}
		add_dynamic_modifier = {
			modifier = industrial_area_Lv2
		}
		remove_dynamic_modifier = {
			modifier = industrial_area_Lv1
		}
	}
	else_if = {
		limit = {
			has_dynamic_modifier = {
				modifier = industrial_area_Lv2
			}
		}
		add_dynamic_modifier = {
			modifier = industrial_area_Lv3
		}
		remove_dynamic_modifier = {
			modifier = industrial_area_Lv2
		}
	}
	else_if = {
		limit = {
			has_dynamic_modifier = {
				modifier = industrial_area_Lv3
			}
		}
		increase_state_category = yes
	}
	else = {
		add_dynamic_modifier = {
			modifier = industrial_area_Lv1
		}
	}
}

urbanizing_region = {
	if = {
		limit = {
			has_dynamic_modifier = {
				modifier = agrarian_state
			}
		}
		remove_dynamic_modifier = {
			modifier = agrarian_state
		}
	}
	else_if = {
		limit = {
			has_dynamic_modifier = {
				modifier = half_industrial_state
			}
		}
		remove_dynamic_modifier = {
			modifier = agrarian_state
		}
	}
	else = {
		increase_state_category = yes
	}
}

replace_civ_with_arms_factories = {
	random_owned_controlled_state = {
		limit = {
			is_fully_controlled_by = ROOT
			industrial_complex > 0
		}
		remove_building = {
			type = industrial_complex
			level = 1
		}
		add_building_construction = {
			type = arms_factory
			level = 2
			instant_build = yes
		}
		add_extra_state_shared_building_slots = 1
	}
	random_owned_controlled_state = {
		limit = {
			is_fully_controlled_by = ROOT
			industrial_complex > 0
		}
		remove_building = {
			type = industrial_complex
			level = 1
		}
		add_building_construction = {
			type = arms_factory
			level = 2
			instant_build = yes
		}
		add_extra_state_shared_building_slots = 1
	}
	random_owned_controlled_state = {
		limit = {
			is_fully_controlled_by = ROOT
			industrial_complex > 0
		}
		remove_building = {
			type = industrial_complex
			level = 1
		}
		add_building_construction = {
			type = arms_factory
			level = 2
			instant_build = yes
		}
		add_extra_state_shared_building_slots = 1
	}
	random_owned_controlled_state = {
		limit = {
			is_fully_controlled_by = ROOT
			industrial_complex > 0
		}
		remove_building = {
			type = industrial_complex
			level = 1
		}
		add_building_construction = {
			type = arms_factory
			level = 2
			instant_build = yes
		}
		add_extra_state_shared_building_slots = 1
	}
	random_owned_controlled_state = {
		limit = {
			is_fully_controlled_by = ROOT
			industrial_complex > 0
		}
		remove_building = {
			type = industrial_complex
			level = 1
		}
		add_building_construction = {
			type = arms_factory
			level = 2
			instant_build = yes
		}
		add_extra_state_shared_building_slots = 1
	}
}

JAP_enact_land_reform = {
	every_owned_state = {
		limit = {
			is_Japan_home_area = yes
		}
		if = {
			limit = {
				OR = {
					has_dynamic_modifier = {
						modifier = half_industrial_state
					}
					has_dynamic_modifier = {
						modifier = agrarian_state
					}
				}
			}
			upgrade_industrial_region = yes
		}
		else = {
			urbanizing_region = yes
		}
	}
}

prioritize_state = {
	add_to_temp_variable = {
		building_index = 1
	}
	meta_effect = {
		text = {
			set_temp_variable = {
				[VARIABLE] = [ID]
			}
		}
		VARIABLE = "building_target_states_[?building_index]"
		ID = "[THIS.GetId]"
	}
}

construction_build_in_best_random_state_effect = {
	if = {
		limit = {
			NOT = {
				has_variable = building_token
			}
		}
		set_temp_variable = {
			building_token = token:industrial_complex
		}
		set_temp_variable = {
			building_token_for_trigger = token:industrial_complex
		}
	}
	else_if = {
		limit = {
			OR = {
				check_variable = {
					building_token = token:synthetic_refinery
				}
				check_variable = {
					building_token = token:fuel_silo
				}
			}
		}
		#uses industrial_complex in the trigger due to synthetic_refinery and fuel_silo resulting in no visible tooltip if the tech isn't unlocked yet
		set_temp_variable = {
			building_token_for_trigger = token:industrial_complex
		}
	}
	else = {
		set_temp_variable = {
			building_token_for_trigger = building_token
		}
	}
	meta_effect = {
		text = {
			for_each_scope_loop = {
				array = owned_controlled_states
				if = {
					limit = {
						free_building_slots = {
							building = [BUILDING_TOKEN_FOR_TRIGGER]
							size > 0
							include_locked = yes
						}
						is_valid_state_for_development = yes
					}
					if = {
						limit = {
							is_core_of = PREV
							is_in_home_area = yes
						}
						set_temp_variable = {
							home_area_core_available = 1
						}
						set_temp_variable = {
							break = 1
						}
						#this is the perfect state, no need to loop any further
					}
					else_if = {
						limit = {
							is_core_of = PREV
						}
						set_temp_variable = {
							core_available = 1
						}
					}
					else_if = {
						limit = {
							is_claimed_by = PREV
							is_in_home_area = yes
						}
						set_temp_variable = {
							home_area_claim_available = 1
						}
					}
					else_if = {
						limit = {
							is_core_of = PREV
						}
						set_temp_variable = {
							claim_available = 1
						}
					}
					else_if = {
						limit = {
							is_in_home_area = yes
						}
						set_temp_variable = {
							home_area_available = 1
						}
					}
				}
			}
			if = {
				limit = {
					has_variable = home_area_core_available
				}
				random_owned_controlled_state = {
					prioritize = {
						[STATES]
					}
					limit = {
						free_building_slots = {
							building = [BUILDING_TOKEN_FOR_TRIGGER]
							size > 0
							include_locked = yes
						}
						is_core_of = PREV
						is_in_home_area = yes
						is_valid_state_for_development = yes
					}
					if = {
						limit = {
							NOT = {
								check_variable = {
									building_token = token:infrastructure
								}
							}
						}
						add_extra_state_shared_building_slots = 1
					}
					add_building_construction = {
						type = [BUILDING]
						level = 1
						instant_build = yes
					}
				}
			}
			else_if = {
				limit = {
					has_variable = core_available
				}
				random_owned_controlled_state = {
					prioritize = {
						[STATES]
					}
					limit = {
						free_building_slots = {
							building = [BUILDING_TOKEN_FOR_TRIGGER]
							size > 0
							include_locked = yes
						}
						is_core_of = PREV
						is_valid_state_for_development = yes
					}
					if = {
						limit = {
							NOT = {
								check_variable = {
									building_token = token:infrastructure
								}
							}
						}
						add_extra_state_shared_building_slots = 1
					}
					add_building_construction = {
						type = [BUILDING]
						level = 1
						instant_build = yes
					}
				}
			}
			else_if = {
				limit = {
					has_variable = home_area_claim_available
				}
				random_owned_controlled_state = {
					prioritize = {
						[STATES]
					}
					limit = {
						free_building_slots = {
							building = [BUILDING_TOKEN_FOR_TRIGGER]
							size > 0
							include_locked = yes
						}
						is_claimed_by = PREV
						is_in_home_area = yes
						is_valid_state_for_development = yes
					}
					if = {
						limit = {
							NOT = {
								check_variable = {
									building_token = token:infrastructure
								}
							}
						}
						add_extra_state_shared_building_slots = 1
					}
					add_building_construction = {
						type = [BUILDING]
						level = 1
						instant_build = yes
					}
				}
			}
			else_if = {
				limit = {
					has_variable = claim_available
				}
				random_owned_controlled_state = {
					prioritize = {
						[STATES]
					}
					limit = {
						free_building_slots = {
							building = [BUILDING_TOKEN_FOR_TRIGGER]
							size > 0
							include_locked = yes
						}
						is_claimed_by = PREV
						is_valid_state_for_development = yes
					}
					if = {
						limit = {
							NOT = {
								check_variable = {
									building_token = token:infrastructure
								}
							}
						}
						add_extra_state_shared_building_slots = 1
					}
					add_building_construction = {
						type = [BUILDING]
						level = 1
						instant_build = yes
					}
				}
			}
			else_if = {
				limit = {
					has_variable = home_area_available
				}
				random_owned_controlled_state = {
					prioritize = {
						[STATES]
					}
					limit = {
						free_building_slots = {
							building = [BUILDING_TOKEN_FOR_TRIGGER]
							size > 0
							include_locked = yes
						}
						is_in_home_area = yes
						is_valid_state_for_development = yes
					}
					if = {
						limit = {
							NOT = {
								check_variable = {
									building_token = token:infrastructure
								}
							}
						}
						add_extra_state_shared_building_slots = 1
					}
					add_building_construction = {
						type = [BUILDING]
						level = 1
						instant_build = yes
					}
				}
			}
			else = {
				random_owned_controlled_state = {
					prioritize = {
						[STATES]
					}
					limit = {
						free_building_slots = {
							building = [BUILDING_TOKEN_FOR_TRIGGER]
							size > 0
							include_locked = yes
						}
						is_valid_state_for_development = yes
					}
					if = {
						limit = {
							NOT = {
								check_variable = {
									building_token = token:infrastructure
								}
							}
						}
						add_extra_state_shared_building_slots = 1
					}
					add_building_construction = {
						type = [BUILDING]
						level = 1
						instant_build = yes
					}
				}
			}
		}
		STATES = "[BC_Target_1] [BC_Target_2] [BC_Target_3] [BC_Target_4] [BC_Target_5] [BC_Target_6] [BC_Target_7] [BC_Target_8] [BC_Target_9] [BC_Target_10] [BC_Target_11] [BC_Target_12] [BC_Target_13] [BC_Target_14] [BC_Target_15]"
		BUILDING = "[?building_token.GetTokenKey]"
		BUILDING_TOKEN_FOR_TRIGGER = "[?building_token_for_trigger.GetTokenKey]"
	}
}

add_one_random_infrastructure = {
	set_temp_variable = {
		building_token = token:infrastructure
	}
	construction_build_in_best_random_state_effect = yes
}

add_one_random_civilian_factory = {
	set_temp_variable = {
		building_token = token:industrial_complex
	}
	construction_build_in_best_random_state_effect = yes
}

add_one_random_military_factory = {
	set_temp_variable = {
		building_token = token:arms_factory
	}
	construction_build_in_best_random_state_effect = yes
}

add_one_random_dockyard = {
	set_temp_variable = {
		building_token = token:dockyard
	}
	construction_build_in_best_random_state_effect = yes
}

add_one_random_synthetic_refinery = {
	set_temp_variable = {
		building_token = token:synthetic_refinery
	}
	construction_build_in_best_random_state_effect = yes
}

add_one_random_fuel_silo = {
	set_temp_variable = {
		building_token = token:fuel_silo
	}
	construction_build_in_best_random_state_effect = yes
}
